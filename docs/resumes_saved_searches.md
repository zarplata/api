# Сохраненные поиски резюме

Сохраненный поиск (автопоиск) — это сохраненный набор параметров поиска, по
которому можно отслеживать новые резюме по заданному запросу.
Помимо сохранения параметров поисковых запросов, автопоиск позволяет получать
оповещения о новых результатах поиска. Для удобства автопоиску можно
задавать имя.

  * [Список сохраненных поисков резюме](#resumes-saved-search-list)
  * [Получение единичного сохраненного поиска резюме](#resumes-saved-search-item)
  * [Создание нового сохраненного поиска резюме](#resumes-saved-search-create)
  * [Обновление сохраненного поиска резюме](#resumes-saved-search-update)
  * [Удаление сохраненного поиска резюме](#resumes-saved-search-delete)
  * [Передача сохраненного поиска резюме другому менеджеру](#resumes-saved-search-move-to-other-manager)

<a name="resumes-saved-search-list"></a>
##  Список сохраненных поисков резюме

```
GET /saved_searches/resumes
```

Дополнительно можно указать
[стандартные параметры пагинации](https://github.com/zarplata/api/blob/master/docs/general.md#pagination)
`page` и `per_page`. По умолчанию `per_page` - `5`, максимальное значение - `10`.

### Ответ

Успешный ответ приходит с кодом `200 OK` и содержит тело:

```json
{
  "per_page": 0,
  "page": 0,
  "pages": 1,
  "found": 2,
  "items": [
    {
      "id": "609535",
      "name": "Managers in Moscow",
      "created_at": "2015-01-01T13:12:17+0400",
      "subscription": true,
      "items": {
        "count": 55,
        "url": "https://api.zarplata.ru/resumes?order_by=publication_time&saved_search_id=123456&text=manager&area=1"
      },
      "new_items": {
        "count": 15,
        "url": "https://api.zarplata.ru/resumes?order_by=publication_time&saved_search_id=123456&text=manager&area=1&last_used=2015-11-12T18%3A06%3A04%2B0300"
      }
    }
  ]
}
```

<a name="resumes-saved-search-object"></a>
Каждый элемент коллекции содержит следующую информацию:

название | тип | комментарий
---------|-----|------------
id | строка | идентификатор
name | строка | название
subscription | логический | подключена ли подписка
items | объект | данные о найденных резюме
new_items | объект | данные о найденных резюме, появившихся с момента последнего просмотра автопоиска

Объекты `items` и `new_items` содержат следующие поля:

название | тип | комментарий
---------|-----|------------
count | int | количество результатов сохраненного поиска
url | строка | ссылка на результаты сохраненного поиска, присутствует, если активирован доступ к поиску резюме

>!! Внимание: счетчик `new_items.count` обновляется раз в час. Из-за этого реальное количество новых найденных резюме 
может расходиться со значением этого счетчика.

### Ошибки

* `403 Forbidden` - запрос не от работодателя

<a name="resumes-saved-search-item"></a>
## Получение единичного сохраненного поиска резюме

```
GET /saved_searches/resumes/{id}
```

где `id` – идентификатор автопоиска.

### Ответ

Успешный ответ приходит с кодом `200 OK` и содержит единичный объект автопоиска,
аналогичный [объектам в списке автопоисков резюме](#resumes-saved-search-object).

### Ошибки

* `403 Forbidden` - запрос не от работодателя
* `404 Not Found` - автопоиск не найден или не доступен текущему пользователю

<a name="resumes-saved-search-create"></a>
## Создание нового сохраненного поиска резюме

Для создания автопоиска неоходимо отправить запрос:

```
POST /saved_searches/resumes
``` 

со следующими параметрами в теле запроса:

* параметры поиска резюме. Соответствуют параметрам,
  передаваемым в поиск резюме [/resumes](resumes_search.md#search-params)

### Ответ

В случае успешного создания вернется ответ `201 Created` с заголовком
`Location`, указывающим на созданный автопоиск:

```
Location: /saved_searches/resumes/123
```

где 123 - id созданного автопоиска

### Ошибки

* `403 Forbidden` - запрос не от работодателя
* `400 Bad request` - параметры указаны неверно или в неправильном сочетании

<a name="resumes-saved-search-update"></a>
## Обновление сохраненного поиска резюме

У сохраненного поиска возможно изменить имя и статус подписки, для этого
необходимо послать 

```
PUT /saved_searches/resumes/{id}
```

где id - идентификатор сохраненного поиска.

За один заход можно изменять только имя (параметр `name`) или только статус
подписки (параметр `subscription=false`)

### Ответ

В случае успешного обновления адреса вернётся HTTP-статус `204 No Content`.

### Ошибки

* `400 Bad Request` - не передан ни один из возможных параметров, либо передан невалидный параметр
* `403 Forbidden` - запрос не от работодателя
* `404 Not Found` - автопоиск не найден или не принадлежит текущему пользователю
* `409 Conflict` - при попытке изменить оба параметра сразу

<a name="resumes-saved-search-delete"></a>
## Удаление сохраненного поиска резюме

Для того, чтобы удалить автопоиск, необходимо выполнить запрос

```
DELETE /saved_searches/resumes/{id}
```

где id - идентификатор автопоиска.

### Ответ

В случае успешного обновления адреса вернётся HTTP-статус `204 No Content`.

### Ошибки

* `403 Forbidden` - запрос не от работодателя
* `404 Not Found` - автопоиск не найден или не принадлежит текущему пользователю


<a name="resumes-saved-search-move-to-other-manager"></a>
## Передача сохраненного поиска резюме другому менеджеру

Для того, чтобы передать автопоиск другому менеджеру, необходимо выполнить запрос
```
PUT /saved_searches/resumes/{saved_search_id}/managers/{manager_id}
```

где:
* saved_search_id - идентификатор автопоиска, 
* manager_id - идентификатор менеджера, которому надо передать автопоиск ([список менеджеров компании](https://github.com/zarplata/api/blob/master/docs/employer_managers.md#list)).

### Ответ

В случае успешного обновления адреса вернётся HTTP-статус `204 No Content`.

### Ошибки

* `403 Forbidden` - запрос не от работодателя
* `404 Not Found` - автопоиск не найден или не принадлежит текущему пользователю
* `404 Not Found` - менеджер не найден
Тело ответа может содержать подробности, позволяющие понять [причину ошибки](errors.md#resumes-saved-searches)(`saved_search_not_found` или `manager_not_found`)
